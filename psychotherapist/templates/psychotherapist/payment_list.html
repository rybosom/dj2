{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ username }} - Płatności</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

    <!--font awesome icons-->
    <script defer src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>

    <!--data tables-->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.16/css/dataTables.bootstrap4.min.css">
    <script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.16/js/dataTables.bootstrap4.min.js"></script>

</head>
<body>

<nav class="navbar navbar-expand-sm bg-info navbar-dark">
    <a class="navbar-brand" href="/">Psychotherapist</a>
    <ul class="navbar-nav">
        <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#"></i>
                {{ username }}</a>
            <div class="dropdown-menu">
                {% if user.is_superuser %}
                <a class="dropdown-item" href="/admin/">
                    <i class="fas fa-cog fa-spin fa-fw"></i>
                    Panel Administratora</a>
                {% else %}
                {% endif %}
                <a class="dropdown-item" href="/admin/password_change/">
                    <i class="fas fa-key fa-fw"></i>
                    Zmień hasło</a>
                <a class="dropdown-item" href="/user_logout/">
                    <i class="fas fa-sign-out-alt fa-fw"></i>
                    Wyloguj się</a>
            </div>
        </li>
    </ul>
    <ul class="navbar-nav">
        <li class="nav-item">
            <a class="nav-link" href="/add_patient/">Dodaj Pacjenta</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/list_patients/">Lista Pacjentów <span class="badge badge-pill badge-secondary">{{ patient_count }}</span></a>
        </li>
        <li class="nav-item">
            <a class="nav-link active" href="/payment_list/">Płatności</a>
        </li>
    </ul>

</nav>

<div class="jumbotron">
    <div class="conainer-fluid">
        <p class="text-muted small">Tabela zawiera dane zrealizowanych płatności oraz nieopłacone sesje, które mają zdefiniowaną datę.</p>
        <form method="post">
            {% csrf_token %}
            <table id="patients" class="table table-striped table-bordered" style="width:100%">
                <thead>
                <tr>
                    <th>Akcja</th>
                    <th>Imię i Nazwisko Pacjenta</th>
                    <th>Numer Sesji</th>
                    <th>Data Sesji</th>
                    <th>Data Płatności</th>
                    <th>Kwota</th>
                    <th>Gotówka / Przelew</th>
                </tr>
                </thead>
                <tbody>
                {% for n in objects %}
                <tr name="object_{{ n.patient.pk }}">
                    <td><button type="button" class="btn btn-danger" data-toggle="modal" data-target="#remove_{{ n.pk }}" title="Usuń płatność"><i class="far fa-trash-alt"></i></button>
                        <a href="{% url 'patient_payments' n.patient_id.pk %}" class="btn btn-info" title="Edytuj płatności"><i class="far fa-edit"></i></a>
                    </td>
                    <td>{{ n.patient_id.firstName }} {{ n.patient_id.lastName }}</td>
                    <td>{{ n.sessionNo }}</td>
                    <td>{{ n.sessionDate|date:'Y-m-d' }}</td>
                    <td>{{ n.paymentDate|date:'Y-m-d' }}</td>
                    <td>{{ n.amount|default_if_none:'' }}</td>
                    <td>{{ n.method|default_if_none:'' }}</td>
                </tr>

                <div id="remove_{{ n.pk }}" class="modal fade" role="dialog">
                    <div class="modal-dialog modal-sm">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title">Pacjent: <strong>{{ n.patient_id.firstName }} {{ n.patient_id.lastName }}</strong></h4>
                            </div>
                            <div class="modal-body">
                                Kwota płatności: <strong>{{ n.amount }}</strong><br>
                                Data płatności: <strong>{{ n.paymentDate|date:'Y-m-d' }}</strong><br>
                                Czy na pewno chcesz usunąć tę płatność?
                            </div>
                            <div class="modal-footer">
                                <div class="btn-group">
                                    <a class="btn btn-danger" href="/payment_list/">Anuluj</a>
                                    <button type="submit" class="btn btn-success" name="rm" value="{{ n.pk }}">Usuń</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                {% endfor %}
                </tbody>
            </table>
        </form>
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function(){
    $('#patients').DataTable( {
        "autoWidth": true,
        "pagingType": "simple_numbers",
        language: {
            "processing":     "Przetwarzanie...",
    "search":         "Szukaj:",
    "lengthMenu":     "Pokaż _MENU_ pozycji",
    "info":           "Pozycje od _START_ do _END_ z _TOTAL_ łącznie",
    "infoEmpty":      "Pozycji 0 z 0 dostępnych",
    "infoFiltered":   "(filtrowanie spośród _MAX_ dostępnych pozycji)",
    "infoPostFix":    "",
    "loadingRecords": "Wczytywanie...",
    "zeroRecords":    "Nie znaleziono pasujących pozycji",
    "emptyTable":     "Brak danych",
    "paginate": {
        "first":      "Pierwsza",
        "previous":   "Poprzednia",
        "next":       "Następna",
        "last":       "Ostatnia"
    },
    "aria": {
        "sortAscending": ": aktywuj, by posortować kolumnę rosnąco",
        "sortDescending": ": aktywuj, by posortować kolumnę malejąco"
    }

        }
    }
    );
});
</script>

</body>
</html>